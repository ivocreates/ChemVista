{% extends "base.html" %}

{% block title %}
{% if query %}Search Results for "{{ query }}"{% else %}Chemical Formula Finder{% endif %} - ChemVista
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
            <li class="breadcrumb-item active">Formula Finder</li>
        </ol>
    </nav>

    <!-- Search Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card search-header shadow-sm">
                <div class="card-body">
                    <h2 class="card-title">
                        <i class="fas fa-search me-2"></i>Chemical Formula Finder
                    </h2>
                    
                    <!-- Search Form -->
                    <form action="{{ url_for('search') }}" method="GET" class="mt-3">
                        <div class="row g-3 align-items-center">
                            <div class="col-lg-8">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text">
                                        <i class="fas fa-flask"></i>
                                    </span>
                                    <input type="text" 
                                           class="form-control" 
                                           name="q" 
                                           value="{{ query }}"
                                           placeholder="Enter compound name or formula (e.g., water, H2O)" 
                                           autocomplete="off">
                                    <button class="btn btn-success" type="submit">
                                        <i class="fas fa-search me-2"></i>Search
                                    </button>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="search-tips">
                                    <small class="text-muted">
                                        <i class="fas fa-lightbulb me-1"></i>
                                        Try: water, H2O, salt, NaCl, glucose
                                    </small>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% if query %}
        <!-- Results Header -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="results-info">
                    <h4>
                        {% if results %}
                            Found {{ results|length }} result{{ 's' if results|length != 1 else '' }} for "{{ query }}"
                        {% else %}
                            No results found for "{{ query }}"
                        {% endif %}
                    </h4>
                </div>
            </div>
        </div>

        {% if results %}
            <!-- Search Results -->
            <div class="row g-4">
                {% for compound in results %}
                <div class="col-lg-6">
                    <div class="card compound-card h-100 shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">{{ compound.name }}</h5>
                                <span class="formula-badge">{{ compound.formula }}</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-text">{{ compound.description[:150] }}{% if compound.description|length > 150 %}...{% endif %}</p>
                            
                            <div class="compound-info mb-3">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <small class="text-muted">Molecular Weight:</small>
                                        <div class="fw-bold">{{ compound.molecular_weight }} g/mol</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Type:</small>
                                        <div class="fw-bold">{{ compound.type }}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">State:</small>
                                        <div class="fw-bold">
                                            <span class="state-indicator state-{{ compound.state.lower() }}">
                                                {% if compound.state == 'Gas' %}
                                                    <i class="fas fa-cloud me-1"></i>
                                                {% elif compound.state == 'Liquid' %}
                                                    <i class="fas fa-tint me-1"></i>
                                                {% else %}
                                                    <i class="fas fa-cube me-1"></i>
                                                {% endif %}
                                                {{ compound.state }}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Solubility:</small>
                                        <div class="fw-bold">{{ compound.solubility }}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="composition-preview mb-3">
                                <small class="text-muted">Composition:</small>
                                <div class="composition-elements">
                                    {% for element in compound.composition %}
                                        <span class="element-tag">
                                            {{ element.symbol }}{% if element.count > 1 %}<sub>{{ element.count }}</sub>{% endif %}
                                        </span>
                                    {% endfor %}
                                </div>
                            </div>

                            <a href="{{ url_for('compound_detail', compound_id=compound.id) }}" 
                               class="btn btn-primary">
                                <i class="fas fa-info-circle me-2"></i>View Details
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- No Results -->
            <div class="row">
                <div class="col-12">
                    <div class="no-results text-center py-5">
                        <div class="no-results-icon mb-4">
                            <i class="fas fa-search fa-4x text-muted"></i>
                        </div>
                        <h3 class="text-muted mb-3">No compounds found</h3>
                        <p class="lead text-muted mb-4">
                            We couldn't find any compounds matching "{{ query }}". 
                            Please try a different search term.
                        </p>
                        
                        <div class="suggestions">
                            <h5 class="mb-3">Try these popular searches:</h5>
                            <div class="d-flex flex-wrap justify-content-center gap-2">
                                <a href="{{ url_for('search', q='water') }}" class="btn btn-outline-primary btn-sm">Water</a>
                                <a href="{{ url_for('search', q='H2O') }}" class="btn btn-outline-primary btn-sm">H₂O</a>
                                <a href="{{ url_for('search', q='carbon dioxide') }}" class="btn btn-outline-primary btn-sm">Carbon Dioxide</a>
                                <a href="{{ url_for('search', q='CO2') }}" class="btn btn-outline-primary btn-sm">CO₂</a>
                                <a href="{{ url_for('search', q='salt') }}" class="btn btn-outline-primary btn-sm">Salt</a>
                                <a href="{{ url_for('search', q='NaCl') }}" class="btn btn-outline-primary btn-sm">NaCl</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    {% else %}
        <!-- Empty State - No Search Yet -->
        <div class="row">
            <div class="col-12">
                <div class="empty-state text-center py-5">
                    <div class="empty-state-icon mb-4">
                        <i class="fas fa-flask fa-4x text-primary"></i>
                    </div>
                    <h3 class="mb-3">Ready to explore chemistry?</h3>
                    <p class="lead text-muted mb-4">
                        Enter a compound name or chemical formula above to discover detailed information about molecular composition and properties.
                    </p>
                    
                    <div class="popular-searches">
                        <h5 class="mb-3">Popular Searches:</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="search-suggestion-card">
                                    <h6>Common Compounds</h6>
                                    <div class="d-flex flex-wrap gap-1">
                                        <a href="{{ url_for('search', q='water') }}" class="badge bg-primary text-decoration-none">Water</a>
                                        <a href="{{ url_for('search', q='salt') }}" class="badge bg-primary text-decoration-none">Salt</a>
                                        <a href="{{ url_for('search', q='sugar') }}" class="badge bg-primary text-decoration-none">Sugar</a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="search-suggestion-card">
                                    <h6>Chemical Formulas</h6>
                                    <div class="d-flex flex-wrap gap-1">
                                        <a href="{{ url_for('search', q='H2O') }}" class="badge bg-success text-decoration-none">H₂O</a>
                                        <a href="{{ url_for('search', q='CO2') }}" class="badge bg-success text-decoration-none">CO₂</a>
                                        <a href="{{ url_for('search', q='NaCl') }}" class="badge bg-success text-decoration-none">NaCl</a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="search-suggestion-card">
                                    <h6>Organic Molecules</h6>
                                    <div class="d-flex flex-wrap gap-1">
                                        <a href="{{ url_for('search', q='glucose') }}" class="badge bg-warning text-decoration-none">Glucose</a>
                                        <a href="{{ url_for('search', q='ethanol') }}" class="badge bg-warning text-decoration-none">Ethanol</a>
                                        <a href="{{ url_for('search', q='methane') }}" class="badge bg-warning text-decoration-none">Methane</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_head %}
<style>
.compound-card {
    transition: transform 0.2s ease;
}

.compound-card:hover {
    transform: translateY(-5px);
}

.formula-badge {
    background: rgba(255, 255, 255, 0.2);
    padding: 4px 8px;
    border-radius: 15px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

.state-indicator {
    padding: 4px 8px;
    border-radius: 15px;
    font-size: 0.85rem;
}

.state-gas { background: #e3f2fd; color: #1976d2; }
.state-liquid { background: #e0f2f1; color: #00796b; }
.state-solid { background: #f3e5f5; color: #7b1fa2; }

.element-tag {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    padding: 2px 6px;
    border-radius: 12px;
    font-size: 0.8rem;
    margin-right: 4px;
    font-family: 'Courier New', monospace;
}

.composition-elements {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-top: 4px;
}

.search-suggestion-card {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.search-suggestion-card h6 {
    margin-bottom: 10px;
    color: #495057;
}

.no-results-icon, .empty-state-icon {
    opacity: 0.5;
}

.results-info h4 {
    color: #495057;
    font-weight: 600;
}

.search-tips {
    text-align: right;
}

@media (max-width: 768px) {
    .search-tips {
        text-align: left;
        margin-top: 10px;
    }
}
</style>
{% endblock %}
