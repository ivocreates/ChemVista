{% extends "base.html" %}

{% block title %}ChemVista - Complete Interactive Periodic Table & Formula Finder{% endblock %}

{% block main_class %}container-fluid px-0{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="hero-title">
                    <i class="fas fa-atom me-3"></i>ChemVista
                </h1>
                <p class="lead mb-4">
                    Explore the complete periodic table with all 118 elements and discover the fascinating world of chemistry. 
                    Click on any element to explore its properties, or search through our extensive compound database.
                </p>
                <div class="d-flex gap-3 flex-wrap">
                    <button class="btn btn-custom" onclick="scrollToPeriodicTable()">
                        <i class="fas fa-table me-2"></i>Explore Periodic Table
                    </button>
                    <button class="btn btn-custom" onclick="scrollToFormula()">
                        <i class="fas fa-search me-2"></i>Find Compounds
                    </button>
                </div>
            </div>
            <div class="col-lg-4 text-center">
                <div class="hero-animation">
                    <i class="fas fa-flask fa-5x opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<div class="container-fluid">
    <div class="row g-4 p-4">
        <!-- Periodic Table Column -->
        <div class="col-12" id="periodic-table-section">
            <div class="periodic-table-container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0">
                        <i class="fas fa-table me-2"></i>Complete Interactive Periodic Table
                    </h3>
                    <small class="text-muted">All 118 Elements • Click to explore</small>
                </div>
                
                <!-- Periodic Table Grid -->
                <div class="periodic-table" id="periodicTable">
                    <!-- Elements will be dynamically generated here -->
                </div>
                
                <!-- Lanthanides and Actinides -->
                <div class="mt-4">
                    <div class="row">
                        <div class="col-12">
                            <h5 class="mb-3">Lanthanides</h5>
                            <div class="lanthanides-grid" id="lanthanidesGrid">
                                <!-- Lanthanides will be generated here -->
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <h5 class="mb-3">Actinides</h5>
                            <div class="actinides-grid" id="actinidesGrid">
                                <!-- Actinides will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Search and Legend Row -->
    <div class="row g-4 p-4">
        <!-- Chemical Formula Finder -->
        <div class="col-lg-6" id="formula-finder-section">
            <div class="search-container">
                <h3 class="mb-3">
                    <i class="fas fa-search me-2"></i>Chemical Formula Finder
                </h3>
                <p class="text-muted mb-4">Search for chemical compounds by name or formula</p>
                
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" 
                           class="search-input" 
                           id="compoundSearch" 
                           placeholder="Enter compound name (e.g., water) or formula (e.g., H2O)">
                    <div class="suggestions" id="suggestions"></div>
                </div>
                
                <div class="search-examples mt-3">
                    <small class="text-muted">Examples:</small>
                    <div class="mt-2">
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="searchExample('water')">Water</button>
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="searchExample('CO2')">CO₂</button>
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="searchExample('glucose')">Glucose</button>
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="searchExample('caffeine')">Caffeine</button>
                    </div>
                </div>
                
                <div id="searchResults" class="mt-4"></div>
            </div>
        </div>
        
        <!-- Legend and Information -->
        <div class="col-lg-6">
            <div class="legend">
                <h3 class="mb-3">
                    <i class="fas fa-palette me-2"></i>Element Categories
                </h3>
                <div class="legend-grid">
                    <div class="legend-item">
                        <div class="legend-color alkali-metal"></div>
                        <span>Alkali Metals</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color alkaline-earth"></div>
                        <span>Alkaline Earth Metals</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color transition-metal"></div>
                        <span>Transition Metals</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color post-transition"></div>
                        <span>Post-transition Metals</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color metalloid"></div>
                        <span>Metalloids</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color reactive-nonmetal"></div>
                        <span>Reactive Nonmetals</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color halogen"></div>
                        <span>Halogens</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color noble-gas"></div>
                        <span>Noble Gases</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color lanthanide"></div>
                        <span>Lanthanides</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color actinide"></div>
                        <span>Actinides</span>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h5>Quick Stats</h5>
                    <div class="row">
                        <div class="col-6">
                            <div class="stat-item">
                                <strong>{{ elements|length }}</strong>
                                <small class="d-block">Total Elements</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <strong>200+</strong>
                                <small class="d-block">Chemical Compounds</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Dynamic Periodic Table -->
<script>
// Elements data from server
const elements = JSON.parse('{{ elements|tojson | safe }}');

// Periodic table structure - defines the grid layout
const periodicTableStructure = [
    // Period 1
    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2],
    // Period 2
    [3, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 6, 7, 8, 9, 10],
    // Period 3
    [11, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 13, 14, 15, 16, 17, 18],
    // Period 4
    [19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
    // Period 5
    [37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54],
    // Period 6
    [55, 56, 'La', 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86],
    // Period 7
    [87, 88, 'Ac', 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118]
];

// Lanthanides (57-71)
const lanthanides = [57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71];

// Actinides (89-103)
const actinides = [89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103];

function generatePeriodicTable() {
    const tableContainer = document.getElementById('periodicTable');
    
    // Create the main periodic table
    periodicTableStructure.forEach((period, periodIndex) => {
        period.forEach((atomicNumber, groupIndex) => {
            const cell = document.createElement('div');
            cell.style.gridRow = periodIndex + 1;
            cell.style.gridColumn = groupIndex + 1;
            
            if (atomicNumber === 0) {
                // Empty cell
                cell.className = 'empty-cell';
            } else if (atomicNumber === 'La' || atomicNumber === 'Ac') {
                // Placeholder for lanthanides/actinides
                cell.className = 'element placeholder';
                cell.innerHTML = `
                    <div class="symbol">${atomicNumber}*</div>
                    <div class="name">${atomicNumber === 'La' ? 'Lanthanides' : 'Actinides'}</div>
                `;
                if (atomicNumber === 'La') {
                    cell.style.background = 'var(--lanthanide)';
                } else {
                    cell.style.background = 'var(--actinide)';
                }
            } else {
                // Real element
                const element = elements.find(el => el.atomic_number === atomicNumber);
                if (element) {
                    cell.className = `element ${element.category}`;
                    cell.innerHTML = `
                        <div class="atomic-number">${element.atomic_number}</div>
                        <div class="symbol">${element.symbol}</div>
                        <div class="name">${element.name}</div>
                    `;
                    cell.setAttribute('data-element', element.atomic_number);
                    cell.setAttribute('title', `${element.name} (${element.symbol}) - ${element.description}`);
                    cell.onclick = () => showElementDetails(element);
                }
            }
            
            tableContainer.appendChild(cell);
        });
    });
    
    // Generate lanthanides
    generateSeparateSeries('lanthanidesGrid', lanthanides);
    
    // Generate actinides
    generateSeparateSeries('actinidesGrid', actinides);
}

function generateSeparateSeries(containerId, atomicNumbers) {
    const container = document.getElementById(containerId);
    container.className = 'series-grid';
    
    atomicNumbers.forEach(atomicNumber => {
        const element = elements.find(el => el.atomic_number === atomicNumber);
        if (element) {
            const cell = document.createElement('div');
            cell.className = `element ${element.category}`;
            cell.innerHTML = `
                <div class="atomic-number">${element.atomic_number}</div>
                <div class="symbol">${element.symbol}</div>
                <div class="name">${element.name}</div>
            `;
            cell.setAttribute('data-element', element.atomic_number);
            cell.setAttribute('title', `${element.name} (${element.symbol}) - ${element.description}`);
            cell.onclick = () => showElementDetails(element);
            container.appendChild(cell);
        }
    });
}

function showElementDetails(element) {
    // Navigate to element detail page
    window.location.href = `/element/${element.atomic_number}`;
}

// Search functionality
let searchTimeout;
document.getElementById('compoundSearch').addEventListener('input', function(e) {
    clearTimeout(searchTimeout);
    const query = e.target.value.trim();
    
    if (query.length < 2) {
        document.getElementById('suggestions').style.display = 'none';
        return;
    }
    
    searchTimeout = setTimeout(() => {
        fetch(`/api/search?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                showSuggestions(data.slice(0, 5));
            })
            .catch(error => console.error('Search error:', error));
    }, 300);
});

function showSuggestions(results) {
    const suggestionsDiv = document.getElementById('suggestions');
    
    if (results.length === 0) {
        suggestionsDiv.style.display = 'none';
        return;
    }
    
    suggestionsDiv.innerHTML = results.map(result => 
        `<div class="suggestion-item" onclick="selectSuggestion('${result.id}')">
            <strong>${result.name}</strong>
            <span class="formula">${result.formula}</span>
        </div>`
    ).join('');
    
    suggestionsDiv.classList.add('show');
}

function selectSuggestion(compoundId) {
    window.location.href = `/compound/${compoundId}`;
}

function searchExample(query) {
    document.getElementById('compoundSearch').value = query;
    document.getElementById('compoundSearch').dispatchEvent(new Event('input'));
}

// Smooth scrolling functions
function scrollToPeriodicTable() {
    document.getElementById('periodic-table-section').scrollIntoView({ 
        behavior: 'smooth' 
    });
}

function scrollToFormula() {
    document.getElementById('formula-finder-section').scrollIntoView({ 
        behavior: 'smooth' 
    });
}

// Initialize the periodic table when page loads
document.addEventListener('DOMContentLoaded', function() {
    generatePeriodicTable();
});
</script>

<style>
.periodic-table {
    display: grid;
    grid-template-columns: repeat(18, 1fr);
    gap: 2px;
    max-width: 100%;
    margin: 0 auto;
    padding: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--border-radius);
}

/* Legend color classes */
.legend-color.alkali-metal { background: var(--alkali-metal); }
.legend-color.alkaline-earth { background: var(--alkaline-earth); }
.legend-color.transition-metal { background: var(--transition-metal); }
.legend-color.post-transition { background: var(--post-transition); }
.legend-color.metalloid { background: var(--metalloid); }
.legend-color.reactive-nonmetal { background: var(--reactive-nonmetal); }
.legend-color.halogen { background: var(--halogen); }
.legend-color.noble-gas { background: var(--noble-gas); }
.legend-color.lanthanide { background: var(--lanthanide); }
.legend-color.actinide { background: var(--actinide); }

.series-grid {
    display: grid;
    grid-template-columns: repeat(15, 1fr);
    gap: 2px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--border-radius);
}

.empty-cell {
    min-height: 60px;
}

.placeholder {
    background: rgba(255, 255, 255, 0.2) !important;
    border: 2px dashed rgba(255, 255, 255, 0.5);
    cursor: default;
}

.stat-item {
    text-align: center;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    margin-bottom: 0.5rem;
}

.search-examples button {
    transition: var(--transition);
}

.search-examples button:hover {
    background-color: var(--secondary-color);
    color: white;
    border-color: var(--secondary-color);
}

/* Responsive adjustments */
@media (max-width: 1200px) {
    .periodic-table {
        grid-template-columns: repeat(18, minmax(45px, 1fr));
        gap: 1px;
    }
    
    .series-grid {
        grid-template-columns: repeat(15, minmax(45px, 1fr));
        gap: 1px;
    }
    
    .element {
        min-height: 50px;
        font-size: 0.7rem;
    }
    
    .element .symbol {
        font-size: 1rem;
    }
}

@media (max-width: 768px) {
    .periodic-table {
        grid-template-columns: repeat(18, minmax(35px, 1fr));
        gap: 1px;
    }
    
    .series-grid {
        grid-template-columns: repeat(10, minmax(35px, 1fr));
    }
    
    .element {
        min-height: 40px;
        font-size: 0.6rem;
    }
    
    .element .symbol {
        font-size: 0.9rem;
    }
    
    .element .name {
        display: none;
    }
    
    .hero-title {
        font-size: 2.5rem;
    }
}

@media (max-width: 480px) {
    .periodic-table {
        grid-template-columns: repeat(9, 1fr);
    }
    
    .series-grid {
        grid-template-columns: repeat(8, 1fr);
    }
}
</style>

{% endblock %}

{% block extra_js %}
<!-- Additional JavaScript can be added here -->
{% endblock %}
