{% extends "base.html" %}

{% block title %}ChemVista - Complete Periodic Table Explorer{% endblock %}

{% block extra_css %}
<style>
    .hero-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 4rem 0;
        margin-bottom: 2rem;
        border-radius: 0 0 30px 30px;
    }
    
    /* Main Content Layout */
    .main-content-container {
        display: flex !important;
        flex-direction: row !important;
        gap: 1.5rem;
        width: 100%;
        align-items: flex-start;
    }
    
    .periodic-table-section {
        flex: 2 1 65% !important;
        min-width: 0;
        max-width: 65%;
        width: 65%;
    }
    
    .formula-finder-section {
        flex: 1 1 30% !important;
        min-width: 300px;
        max-width: 35%;
        width: 30%;
        position: sticky;
        top: 20px;
        height: fit-content;
    }
    
    /* Ensure no conflicting display properties */
    .container-fluid .main-content-container {
        display: flex !important;
    }
    
    .container-fluid .main-content-container .periodic-table-section,
    .container-fluid .main-content-container .formula-finder-section {
        display: block !important;
    }
    
    /* Periodic Table Styles */
    .periodic-table-container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 16px;
        padding: 1.2rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        height: fit-content;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .periodic-table {
        display: grid;
        grid-template-columns: repeat(18, minmax(30px, 1fr));
        gap: 1.5px;
        max-width: 100%;
        margin: 0 auto;
        padding: 0.8rem;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .element {
        aspect-ratio: 1;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        text-decoration: none;
        border-radius: 8px;
        padding: 0.25rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
        min-height: 40px;
        min-width: 30px;
        font-size: 0.6rem;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        animation: elementFadeIn 0.6s ease-out forwards;
        opacity: 0;
        transform: translateY(10px);
    }
    
    @keyframes elementFadeIn {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .element:hover {
        transform: translateY(-3px) scale(1.08);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.25);
        z-index: 10;
        border: 2px solid rgba(255, 255, 255, 0.4);
    }
    
    .element-number {
        font-size: 0.55rem;
        position: absolute;
        top: 3px;
        left: 4px;
        opacity: 0.8;
        font-weight: 500;
    }
    
    .element-symbol {
        font-size: 1.1rem;
        font-weight: 700;
        margin: 0;
        line-height: 1;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
    
    .element-mass {
        font-size: 0.5rem;
        position: absolute;
        bottom: 3px;
        right: 4px;
        opacity: 0.7;
        font-weight: 400;
    }
    
    /* Formula Finder Styles */
    .formula-finder-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        height: 580px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }
    
    .finder-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
    }
    
    .finder-subtitle {
        color: var(--text-secondary);
        font-size: 0.85rem;
        margin-bottom: 1rem;
    }
    
    .finder-input-container {
        position: relative;
        margin-bottom: 0.8rem;
    }
    
    .finder-input {
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(102, 126, 234, 0.2);
        border-radius: 12px;
        padding: 0.8rem 2.5rem 0.8rem 0.8rem;
        font-size: 0.9rem;
        width: 100%;
        transition: all 0.3s ease;
    }
    
    .finder-input:focus {
        outline: none;
        border-color: var(--primary-color);
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .finder-icon {
        position: absolute;
        right: 0.8rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-light);
        font-size: 1rem;
    }
    
    .finder-tabs {
        display: flex;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 8px;
        padding: 2px;
        margin-bottom: 0.8rem;
    }
    
    .finder-tab {
        flex: 1;
        background: transparent;
        border: none;
        padding: 0.4rem 0.6rem;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .finder-tab.active {
        background: white;
        color: var(--primary-color);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    
    .finder-content {
        display: none;
        flex: 1;
        overflow-y: auto;
    }
    
    .finder-content.active {
        display: block;
    }
    
    .finder-results {
        max-height: 350px;
        overflow-y: auto;
    }
    
    .finder-result {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        padding: 0.8rem;
        margin-bottom: 0.4rem;
        cursor: pointer;
        transition: all 0.3s ease;
        border-left: 3px solid var(--primary-color);
        border: 1px solid rgba(102, 126, 234, 0.1);
    }
    
    .finder-result:hover {
        background: white;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    /* Calculator Styles */
    .calc-input-group {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .calc-input {
        flex: 1;
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid rgba(102, 126, 234, 0.2);
        border-radius: 12px;
        padding: 0.8rem;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }
    
    .calc-input:focus {
        outline: none;
        border-color: var(--primary-color);
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .calc-btn {
        background: var(--primary-color);
        border: none;
        border-radius: 12px;
        padding: 0.8rem 1rem;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .calc-btn:hover {
        background: var(--secondary-color);
        transform: translateY(-1px);
    }
    
    .calc-results {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
        padding: 1rem;
        min-height: 100px;
    }
    
    .calc-result-item {
        padding: 0.5rem 0;
        border-bottom: 1px solid rgba(102, 126, 234, 0.1);
    }
    
    .calc-result-item:last-child {
        border-bottom: none;
    }
    
    .no-results-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        color: var(--text-secondary);
        text-align: center;
    }
    
    .no-results-state i {
        font-size: 2rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }
    
    /* Formula Category Styles */
    .formula-category {
        margin-bottom: 1.5rem;
    }
    
    .formula-category h5 {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 0.8rem;
    }
    
    .formula-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
    }
    
    .formula-item {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        padding: 0.6rem;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid rgba(102, 126, 234, 0.1);
        text-align: center;
    }
    
    .formula-item:hover {
        background: white;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .formula-item .formula {
        display: block;
        font-weight: 600;
        color: var(--primary-color);
        font-size: 0.9rem;
    }
    
    .formula-item .name {
        display: block;
        font-size: 0.7rem;
        color: var(--text-secondary);
        margin-top: 0.2rem;
    }
    
    .result-name {
        font-weight: 600;
        color: var(--primary-color);
        font-size: 0.9rem;
    }
    
    .result-formula {
        font-family: 'JetBrains Mono', monospace;
        font-weight: 500;
        color: var(--text-primary);
        margin: 0.2rem 0;
    }
    
    .result-details {
        font-size: 0.8rem;
        color: var(--text-secondary);
    }
    
    /* Statistics Section */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 16px;
        padding: 1.5rem;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        font-size: 0.9rem;
        color: var(--text-secondary);
        font-weight: 500;
    }
    
    /* Section Titles */
    .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        text-align: center;
    }
    
    /* Legend Styles - Improved */
    .legend {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 0.8rem;
        background: rgba(255, 255, 255, 0.95);
        padding: 1.5rem;
        border-radius: 16px;
        backdrop-filter: blur(20px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        padding: 0.4rem 0.6rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.5);
    }
    
    .legend-item:hover {
        background: rgba(255, 255, 255, 0.8);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .legend-color {
        width: 18px;
        height: 18px;
        border-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .legend-label {
        font-size: 0.85rem;
        color: var(--text-primary);
        font-weight: 500;
    }
    
    /* Element Category Colors - Improved and Scientifically Accurate */
    .alkali-metal, .legend-color.alkali-metal { 
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); 
        color: white;
    }
    .alkaline-earth-metal, .legend-color.alkaline-earth-metal { 
        background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%); 
        color: #2c2c2c;
    }
    .transition-metal, .legend-color.transition-metal { 
        background: linear-gradient(135deg, #48dbfb 0%, #0abde3 100%); 
        color: white;
    }
    .post-transition-metal, .legend-color.post-transition-metal { 
        background: linear-gradient(135deg, #1dd1a1 0%, #10ac84 100%); 
        color: white;
    }
    .metalloid, .legend-color.metalloid { 
        background: linear-gradient(135deg, #a55eea 0%, #8b5cf6 100%); 
        color: white;
    }
    .nonmetal, .legend-color.nonmetal { 
        background: linear-gradient(135deg, #26de81 0%, #20bf6b 100%); 
        color: white;
    }
    .halogen, .legend-color.halogen { 
        background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%); 
        color: white;
    }
    .noble-gas, .legend-color.noble-gas { 
        background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%); 
        color: white;
    }
    .lanthanide, .legend-color.lanthanide { 
        background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); 
        color: white;
    }
    .actinide, .legend-color.actinide { 
        background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%); 
        color: #2c2c2c;
    }
    
    /* Hero Section */
    .hero-title {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 1rem;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    
    .hero-subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
        font-weight: 400;
    }
    
    /* Lanthanides and Actinides */
    .lanthanides-row,
    .actinides-row {
        display: grid;
        grid-template-columns: repeat(15, 1fr);
        gap: 1px;
        margin-top: 1rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }
    
    .lanthanide,
    .actinide {
        aspect-ratio: 1;
        border-radius: 8px;
        padding: 0.25rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.6rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 40px;
        text-decoration: none;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        color: white;
    }
    
    .lanthanide:hover,
    .actinide:hover {
        transform: translateY(-3px) scale(1.08);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.25);
        z-index: 10;
        border: 2px solid rgba(255, 255, 255, 0.4);
    }
    
    /* Responsive Design */
    @media (max-width: 992px) {
        .main-content-container {
            flex-direction: column !important;
        }
        
        .periodic-table-section,
        .formula-finder-section {
            flex: none;
            width: 100%;
            max-width: 100%;
        }
        
        .formula-finder-section {
            position: static;
        }
        
        .periodic-table {
            grid-template-columns: repeat(18, minmax(22px, 1fr));
        }
        
        .element {
            min-height: 32px;
            font-size: 0.55rem;
        }
        
        .element-symbol {
            font-size: 0.9rem;
        }
        
        .formula-finder-card {
            height: auto;
            max-height: 500px;
        }
        
        .legend {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
    }
    
    @media (max-width: 768px) {
        .periodic-table {
            grid-template-columns: repeat(9, 1fr);
        }
        
        .element {
            min-height: 28px;
            font-size: 0.5rem;
        }
        
        .element-symbol {
            font-size: 0.8rem;
        }
        
        .lanthanides-row,
        .actinides-row {
            grid-template-columns: repeat(8, 1fr);
        }
        
        .legend {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.6rem;
            padding: 1rem;
        }
        
        .legend-item {
            padding: 0.3rem 0.4rem;
        }
        
        .legend-label {
            font-size: 0.8rem;
        }
    }
    
    @media (max-width: 576px) {
        .periodic-table {
            grid-template-columns: repeat(6, 1fr);
        }
        
        .element {
            min-height: 25px;
            font-size: 0.45rem;
        }
        
        .element-symbol {
            font-size: 0.6rem;
        }
        
        .lanthanides-row,
        .actinides-row {
            grid-template-columns: repeat(5, 1fr);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Hero Section -->
    <section class="hero-section text-center py-5">
        <div class="container">
            <h1 class="hero-title">ChemVista - Chemistry Explorer</h1>
            <p class="hero-subtitle">Explore the periodic table, calculate molecular weights, and find chemical formulas</p>
        </div>
    </section>

    <!-- Statistics -->
    <section class="container mb-4">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">118</div>
                <div class="stat-label">Total Elements</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">200+</div>
                <div class="stat-label">Compounds</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">7</div>
                <div class="stat-label">Periods</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">18</div>
                <div class="stat-label">Groups</div>
            </div>
        </div>
    </section>

    <!-- Main Content - Side by Side Layout -->
    <section class="container-fluid px-3">
        <div class="main-content-container">
            <!-- Left Column: Periodic Table -->
            <div class="periodic-table-section">
                <div class="periodic-table-container">
                    <h2 class="section-title">Interactive Periodic Table</h2>
                    <div class="periodic-table">
                        {% for element in elements[:86] %}
                            {% if element.number <= 86 %}
                            <a href="{{ url_for('element_detail', number=element.number) }}" 
                               class="element {{ element.category|replace('-', '-') }}" 
                               title="{{ element.name }} ({{ element.symbol }}) - Click for details"
                               style="animation-delay: {{ (element.number * 0.02) }}s;">
                                <div class="element-number">{{ element.number }}</div>
                                <div class="element-symbol">{{ element.symbol }}</div>
                                {% if element.atomic_mass %}
                                <div class="element-mass">{{ "%.3g"|format(element.atomic_mass) }}</div>
                                {% endif %}
                            </a>
                            {% endif %}
                        {% endfor %}
                    </div>

                    <!-- Lanthanides -->
                    <div class="lanthanides-row">
                        <div style="grid-column: 1; font-weight: 600; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);">
                            Lanthanides
                        </div>
                        {% for element in elements[56:71] %}
                            {% if element.category == 'lanthanide' %}
                            <a href="{{ url_for('element_detail', number=element.number) }}" 
                               class="lanthanide lanthanide" 
                               title="{{ element.name }} ({{ element.symbol }}) - Click for details">
                                <div class="element-number">{{ element.number }}</div>
                                <div class="element-symbol">{{ element.symbol }}</div>
                            </a>
                            {% endif %}
                        {% endfor %}
                    </div>

                    <!-- Actinides -->
                    <div class="actinides-row">
                        <div style="grid-column: 1; font-weight: 600; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);">
                            Actinides
                        </div>
                        {% for element in elements[88:103] %}
                            {% if element.category == 'actinide' %}
                            <a href="{{ url_for('element_detail', number=element.number) }}" 
                               class="actinide actinide" 
                               title="{{ element.name }} ({{ element.symbol }}) - Click for details">
                                <div class="element-number">{{ element.number }}</div>
                                <div class="element-symbol">{{ element.symbol }}</div>
                            </a>
                            {% endif %}
                        {% endfor %}
                    </div>

                    <!-- Super heavy elements (104-118) -->
                    <div class="periodic-table" style="margin-top: 1rem;">
                        {% for element in elements[103:118] %}
                            {% if element.number >= 104 %}
                            <a href="{{ url_for('element_detail', number=element.number) }}" 
                               class="element {{ element.category|replace('-', '-') }}" 
                               title="{{ element.name }} ({{ element.symbol }}) - Click for details"
                               style="grid-column: {{ ((element.number - 104) % 18) + 1 }}; grid-row: 1;">
                                <div class="element-number">{{ element.number }}</div>
                                <div class="element-symbol">{{ element.symbol }}</div>
                                {% if element.atomic_mass %}
                                <div class="element-mass">{{ "%.3g"|format(element.atomic_mass) }}</div>
                                {% endif %}
                            </a>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Right Column: Formula Finder & Tools -->
            <div class="formula-finder-section">
                <div class="formula-finder-card">
                    <h3 class="finder-title">
                        <i class="fas fa-search me-2"></i>
                        Formula & Compound Finder
                    </h3>
                    <p class="finder-subtitle">Search for chemical formulas, compounds, and elements</p>
                    
                    <!-- Finder Input -->
                    <div class="finder-input-container">
                        <input type="text" 
                               class="finder-input" 
                               id="formulaSearch" 
                               placeholder="Type formula or compound name...">
                        <i class="fas fa-search finder-icon"></i>
                    </div>
                    
                    <!-- Finder Tabs -->
                    <div class="finder-tabs">
                        <button class="finder-tab active" data-tab="search">Search</button>
                        <button class="finder-tab" data-tab="calculator">Calculator</button>
                        <button class="finder-tab" data-tab="formulas">Common</button>
                    </div>
                    
                    <!-- Search Tab Content -->
                    <div class="finder-content active" id="search-content">
                        <div class="finder-results" id="finder-results">
                            <div class="no-results-state">
                                <i class="fas fa-flask"></i>
                                <p>Start typing to search for formulas...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculator Tab Content -->
                    <div class="finder-content" id="calculator-content">
                        <div class="calc-input-group">
                            <input type="text" 
                                   class="calc-input" 
                                   id="molecularFormula" 
                                   placeholder="e.g., H2O, CO2, NaCl">
                            <button class="calc-btn" onclick="calculateMolecularWeight()">
                                <i class="fas fa-calculator"></i>
                            </button>
                        </div>
                        <div class="calc-results" id="calc-results">
                            <div class="no-results-state">
                                <i class="fas fa-calculator"></i>
                                <p>Enter a formula to calculate molecular weight</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Common Formulas Tab Content -->
                    <div class="finder-content" id="formulas-content">
                        <div class="formula-category">
                            <h5>Common Compounds</h5>
                            <div class="formula-grid">
                                <div class="formula-item" onclick="searchFormula('H2O')">
                                    <span class="formula">H₂O</span>
                                    <span class="name">Water</span>
                                </div>
                                <div class="formula-item" onclick="searchFormula('CO2')">
                                    <span class="formula">CO₂</span>
                                    <span class="name">Carbon Dioxide</span>
                                </div>
                                <div class="formula-item" onclick="searchFormula('NaCl')">
                                    <span class="formula">NaCl</span>
                                    <span class="name">Salt</span>
                                </div>
                                <div class="formula-item" onclick="searchFormula('NH3')">
                                    <span class="formula">NH₃</span>
                                    <span class="name">Ammonia</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="formula-category">
                            <h5>Acids & Bases</h5>
                            <div class="formula-grid">
                                <div class="formula-item" onclick="searchFormula('HCl')">
                                    <span class="formula">HCl</span>
                                    <span class="name">Hydrochloric Acid</span>
                                </div>
                                <div class="formula-item" onclick="searchFormula('H2SO4')">
                                    <span class="formula">H₂SO₄</span>
                                    <span class="name">Sulfuric Acid</span>
                                </div>
                                <div class="formula-item" onclick="searchFormula('NaOH')">
                                    <span class="formula">NaOH</span>
                                    <span class="name">Sodium Hydroxide</span>
                                </div>
                                <div class="formula-item" onclick="searchFormula('Ca(OH)2')">
                                    <span class="formula">Ca(OH)₂</span>
                                    <span class="name">Calcium Hydroxide</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="formula-category">
                            <h5>Organic Compounds</h5>
                            <div class="formula-grid">
                                <div class="formula-item" onclick="searchFormula('CH4')">
                                    <span class="formula">CH₄</span>
                                    <span class="name">Methane</span>
                                </div>
                                <div class="formula-item" onclick="searchFormula('C2H6O')">
                                    <span class="formula">C₂H₆O</span>
                                    <span class="name">Ethanol</span>
                                </div>
                                <div class="formula-item" onclick="searchFormula('C6H12O6')">
                                    <span class="formula">C₆H₁₂O₆</span>
                                    <span class="name">Glucose</span>
                                </div>
                                <div class="formula-item" onclick="searchFormula('C8H18')">
                                    <span class="formula">C₈H₁₈</span>
                                    <span class="name">Octane</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Legend -->
    <section class="container mt-5">
        <h2 class="section-title">Element Categories</h2>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color alkali-metal"></div>
                <div class="legend-label">Alkali Metals</div>
            </div>
            <div class="legend-item">
                <div class="legend-color alkaline-earth-metal"></div>
                <div class="legend-label">Alkaline Earth Metals</div>
            </div>
            <div class="legend-item">
                <div class="legend-color transition-metal"></div>
                <div class="legend-label">Transition Metals</div>
            </div>
            <div class="legend-item">
                <div class="legend-color post-transition-metal"></div>
                <div class="legend-label">Post-Transition Metals</div>
            </div>
            <div class="legend-item">
                <div class="legend-color metalloid"></div>
                <div class="legend-label">Metalloids</div>
            </div>
            <div class="legend-item">
                <div class="legend-color nonmetal"></div>
                <div class="legend-label">Nonmetals</div>
            </div>
            <div class="legend-item">
                <div class="legend-color halogen"></div>
                <div class="legend-label">Halogens</div>
            </div>
            <div class="legend-item">
                <div class="legend-color noble-gas"></div>
                <div class="legend-label">Noble Gases</div>
            </div>
            <div class="legend-item">
                <div class="legend-color lanthanide"></div>
                <div class="legend-label">Lanthanides</div>
            </div>
            <div class="legend-item">
                <div class="legend-color actinide"></div>
                <div class="legend-label">Actinides</div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add smooth hover effects to elements
    const elements = document.querySelectorAll('.element, .lanthanide, .actinide');
    
    elements.forEach(element => {
        element.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-3px) scale(1.08) translateZ(0)';
        });
        
        element.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1) translateZ(0)';
        });
    });

    // Formula Finder Functionality
    const formulaSearch = document.getElementById('formulaSearch');
    const finderResults = document.getElementById('finder-results');
    const finderTabs = document.querySelectorAll('.finder-tab');
    const finderContents = document.querySelectorAll('.finder-content');
    let finderTimeout;

    // Tab switching
    finderTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            
            // Update active tab
            finderTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Update active content
            finderContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === targetTab + '-content') {
                    content.classList.add('active');
                }
            });
        });
    });

    // Formula search
    if (formulaSearch) {
        formulaSearch.addEventListener('input', function() {
            clearTimeout(finderTimeout);
            const query = this.value.trim();
            
            if (query.length < 1) {
                finderResults.innerHTML = `
                    <div class="no-results-state">
                        <i class="fas fa-flask"></i>
                        <p>Start typing to search for formulas...</p>
                    </div>
                `;
                return;
            }

            finderTimeout = setTimeout(() => {
                performFormulaSearch(query);
            }, 300);
        });
    }

    async function performFormulaSearch(query) {
        try {
            finderResults.innerHTML = `
                <div class="no-results-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Searching...</p>
                </div>
            `;

            const [elementResponse, compoundResponse] = await Promise.all([
                fetch(`/api/element/search?q=${encodeURIComponent(query)}`),
                fetch(`/api/compound/search?q=${encodeURIComponent(query)}`)
            ]);
            
            const [elementData, compoundData] = await Promise.all([
                elementResponse.json(),
                compoundResponse.json()
            ]);

            displayFormulaResults(elementData, compoundData, query);
        } catch (error) {
            console.error('Formula search error:', error);
            finderResults.innerHTML = `
                <div class="no-results-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Search error. Please try again.</p>
                </div>
            `;
        }
    }

    function displayFormulaResults(elements, compounds, query) {
        let html = '';
        
        // Show matching compounds first
        if (compounds && compounds.length > 0) {
            compounds.forEach(compound => {
                const properties = [];
                if (compound.molecular_weight) properties.push(`MW: ${compound.molecular_weight.toFixed(2)} g/mol`);
                if (compound.state) properties.push(`State: ${compound.state}`);
                if (compound.type) properties.push(`Type: ${compound.type}`);
                
                html += `
                    <div class="finder-result" onclick="searchFormula('${compound.formula}')">
                        <div class="result-name">${compound.name}</div>
                        <div class="result-formula">${compound.formula}</div>
                        <div class="result-details">${properties.join(' • ')}</div>
                    </div>
                `;
            });
        }

        // Show matching elements
        if (elements && elements.length > 0) {
            elements.forEach(element => {
                html += `
                    <div class="finder-result" onclick="window.location.href='/element/${element.number}'">
                        <div class="result-name">${element.name}</div>
                        <div class="result-formula">${element.symbol}</div>
                        <div class="result-details">Atomic #${element.number} • ${element.atomic_mass} u • ${element.category}</div>
                    </div>
                `;
            });
        }

        if (html === '') {
            html = `
                <div class="no-results-state">
                    <i class="fas fa-search"></i>
                    <p>No results found for "${query}"</p>
                    <small>Try searching for chemical formulas, compound names, or element symbols</small>
                </div>
            `;
        }

        finderResults.innerHTML = html;
    }

    // Molecular weight calculator
    window.calculateMolecularWeight = async function() {
        const formula = document.getElementById('molecularFormula').value.trim();
        const resultsDiv = document.getElementById('calc-results');
        
        if (!formula) {
            resultsDiv.innerHTML = `
                <div class="no-results-state">
                    <i class="fas fa-calculator"></i>
                    <p>Enter a formula to calculate molecular weight</p>
                </div>
            `;
            return;
        }

        try {
            resultsDiv.innerHTML = `
                <div class="no-results-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Calculating...</p>
                </div>
            `;

            const response = await fetch('/api/calculate_molecular_weight', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ formula: formula })
            });

            const data = await response.json();

            if (data.success) {
                let html = `
                    <div class="calc-result-item">
                        <strong>Formula:</strong> ${formula}
                    </div>
                    <div class="calc-result-item">
                        <strong>Molecular Weight:</strong> ${data.molecular_weight.toFixed(4)} g/mol
                    </div>
                `;

                if (data.elements && data.elements.length > 0) {
                    html += '<div class="calc-result-item"><strong>Composition:</strong></div>';
                    data.elements.forEach(element => {
                        html += `
                            <div class="calc-result-item">
                                ${element.symbol}: ${element.count} atom${element.count > 1 ? 's' : ''} 
                                (${element.mass.toFixed(2)} g/mol)
                            </div>
                        `;
                    });
                }

                resultsDiv.innerHTML = html;
            } else {
                resultsDiv.innerHTML = `
                    <div class="no-results-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Error: ${data.error || 'Invalid formula'}</p>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Calculation error:', error);
            resultsDiv.innerHTML = `
                <div class="no-results-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Calculation error. Please try again.</p>
                </div>
            `;
        }
    };

    // Search formula function
    window.searchFormula = function(formula) {
        document.getElementById('formulaSearch').value = formula;
        performFormulaSearch(formula);
        
        // Switch to search tab
        document.querySelector('[data-tab="search"]').click();
    };
});
</script>
{% endblock %}